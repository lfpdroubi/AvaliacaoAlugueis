---
title: "Avaliação de Alugueis"
subtitle: "Parte 03"
author: "Luiz Fernando Palin Droubi"
date: "`r format(Sys.Date(), '%d/%m/%Y')`"
bibliography: referencias.bib
format: 
  metropolis-revealjs:
#    smaller: true
    keep-md: true
    incremental: true  
prefer-html: true
---

# Aspectos Legais

## Lei do Inquilinato {.smaller}

-   A partir da entrada em vigor do Código Civil, em jan/1917, a legislação do inquilinato evoluindo em fases alternadas, ora favorecendo os proprietários, ora os inquilinos [@damato, p. 38].

-   Lei em vigor: a Lei nº 8.245, de 18/10/1991 é uma **lei de ordem pública**, ou seja, atinge os contratos celebrados em particulares, impedindo o estabelecimento de cláusulas contrárias aos seus dispositivos, protegendo assim a parte economicamente mais fraca.

-   Continam regulados pelo Código Civil e pelas leis especiais:

    -   As locações:
        -   de imóveis de propriedade da União, dos Estados e Municípios, de suas autarquias e fundações públicas
        -   de vagas autônomas de garagem ou de espaços para estacionamento de veículos;
        -   de espaços destinados à publicidade;
        -   em apart-hotéis, hotéis-residência ou equiparados, assim considerados aqueles que prestam serviços regulares a seus usuários e como tais sejam autorizados a funcionar;
    -   o arrendamento mercantil, em qualquer de suas modalidades

## Direito de Preferência {.smaller}

> Art. 27. No caso de venda, promessa de venda, cessão ou promessa de cessão de direitos ou dação em pagamento, o locatário tem preferência para adquirir o imóvel locado, em igualdade de condições com terceiros, devendo o locador dar - lhe conhecimento do negócio mediante notificação judicial, extrajudicial ou outro meio de ciência inequívoca. Parágrafo único. A comunicação deverá conter todas as condições do negócio e, em especial, o preço, a forma de pagamento, a existência de ônus reais, bem como o local e horário em que pode ser examinada a documentação pertinente.

> Art. 28. O direito de preferência do locatário caducará se não manifestada, de maneira inequívoca, sua aceitação integral à proposta, no prazo de trinta dias.

> Art. 29. Ocorrendo aceitação da proposta, pelo locatário, a posterior desistência do negócio pelo locador acarreta, a este, responsabilidade pelos prejuízos ocasionados, inclusive lucros cessantes.

## Direito de Preferência {.smaller}

> Art. 30. Estando o imóvel sublocado em sua totalidade, caberá a preferência ao sublocatário e, em seguida, ao locatário. Se forem vários os sublocatários, a preferência caberá a todos, em comum, ou a qualquer deles, se um só for o interessado. Parágrafo único. Havendo pluralidade de pretendentes, caberá a preferência ao locatário mais antigo, e, se da mesma data, ao mais idoso.

> Art. 31. Em se tratando de alienação de mais de uma unidade imobiliária, o direito de preferência incidirá sobre a totalidade dos bens objeto da alienação.

> Art. 32. O direito de preferência não alcança os casos de perda da propriedade ou venda por decisão judicial, permuta, doação, integralização de capital, cisão, fusão e incorporação.

## Ação Revisional de Aluguel {.smaller}

> Art. 68. Na ação revisional de aluguel, que terá o rito sumaríssimo, observar-se-á o seguinte:\
> I – além dos requisitos exigidos pelos arts. 276 e 282 do Código de Processo Civil, a petição inicial deverá indicar o valor do aluguel cuja fixação é pretendida. (Vide Nota mental na página seguinte).\
> II – ao designar a audiência de instrução e julgamento, o juiz, se houver pedido e com base nos elementos fornecidos pelo autor ou nos que indicar, fixará aluguel provisório, não excedente a oitenta por cento do pedido, que será devido desde a citação.\
> III – sem prejuízo da contestação e até a audiência, o réu poderá pedir seja revisto o aluguel provisório, fornecendo os elementos para tanto.\
> IV – na audiência de instrução e julgamento, apresentada a contestação, que deverá conter contraproposta se houver discordância quanto ao valor pretendido, o juiz tentará a conciliação e, não sendo esta possível, suspenderá o ato para a **realização de perícia**, se necessária, designando, desde logo, audiência em continuação.

## Ação Renovatória de aluguel {.smaller}

> Art. 51. Nas locações de imóveis destinados ao comércio, o locatário terá direito à renovação do contrato, por igual prazo, desde que, cumulativamente:\
> I. o contrato a renovar tenha sido celebrado por escrito e com prazo determinado;\
> II. o prazo mínimo do contrato a renovar ou a soma dos prazos ininterruptos dos contratos escritos seja de **cinco anos**; (g. n.)\
> III. o locatário esteja explorando seu comércio, no mesmo ramo, pelo prazo mínimo e ininterrupto de três anos.\
> Art. 52. O locador não estará obrigado a renovar o contrato se:\
> I – por determinação do Poder Público, tiver que realizar no imóvel obras que importarem na sua radical transformação; **ou para fazer modificação de tal natureza que aumente o valor do negócio ou da propriedade**;(g. n.)\
> II – o imóvel vier a ser utilizado por ele próprio ou para transferência de fundo de comércio existente há mais de um ano, sendo detentor da maioria do capital o locador, seu cônjuge, ascendente ou descendente.

-   Este direito de renovação pelo locatário nos contratos com prazo maior ou igual a 5 anos é que enseja a cobrança de luvas!

## Ação Renovatória de aluguel {.smaller}

### Contestação

> Art. 72. A contestação do locador, além da defesa de direito que possa caber, ficará adstrita, quanto à matéria de fato, ao seguinte:\
> ...\
> II – não atender, a proposta do locatário, o valor locativo real do imóvel na época da renovação, excluída a valorização trazida por aquele ao ponto ou lugar;\
> III – ter proposta de terceiro para a locação, em condições melhores;\
> IV – não estar obrigado a renovar a locação (incisos I e II do art. 52).\
> § 1o . No caso do inciso II, o locador deverá apresentar, em contraproposta, as condições que repute compatíveis com o valor locativo real e atual do imóvel.\
> § 2o .\
> § 3o . No caso do inciso I do art. 52, a contestação deverá trazer prova da determinação do Poder Público ou relatório pormenorizado das obras a serem realizadas e da estimativa de valorização que sofrerá o imóvel, **assinado por engenheiro devidamente habilitado**. (Grifo nosso!!)

# O Método Comparativo

## O Método Comparativo

-   O Método Comparativo Direto de Dados de Mercado (MCDDM) tenta contornar a necessidade de estabelecimento de uma taxa de remuneração do capital, através da pesquisa direta de dados de mercado de aluguéis de imóveis com diferentes características

-   O Método Comparativo é o preferido quando existem dados de comparação disponíveis contemporâneos aos do avaliando

-   É mais viável em algumas tipologias, como a de salas comercais, lojas, apartamentos, etc.

-   Pode ser utilizado o Tratamento Científico (preferencialmente) e/ou o Tratamento por Fatores

-   O Tratamento por Fatores acaba sendo bastante utilizado em algumas tipologias devido à escassez de dados.

## O Método Comparativo {.smaller}

-   Independente do tratamento, é interessante conhecer os parâmetros do IBAPE/SP para cálculo de valores de imóveis urbanos.

-   Para o IBAPE/SP:

    -   $V_I = V_T + V_B = (V_T + C_B).F_c$
        -   $V_B$ é chamado de "Valor de Venda da Benfeitoria"
    -   $V_B = \text{CUB-SP}.P_C.A_c.F_{OC}$
        -   $P_C$: Índice referente à tipologia e padrão
        -   $A_C$: Área construída da edificação
        -   $F_{OC}$: Fator de Adequação ao obsoletismo e ao estado de conservação
    -   $F_{OC} = R+K_D(1-R)$
        -   $R$: valor residual da edificiação
        -   $K_D$: coeficiente de depreciação de Ross-Heidecke
    -   $K_D = (1-E_c). \left ( 1-0,5\left (\frac{I_E}{I_R}+\frac{I_E^2}{I_R^2}\right) \right)$
        -   $I_E$: Idade da Edificação
        -   $I_R$: Idade de Referência
        -   $E_C$: Estado de Conservação (Heidecke)

## O Método Comparativo {.smaller}

-   Também é usual efetuar a depreciação pelo método do valor descrescente:
    -   $F_{OC}= (1-R)^{I_E}$
        -   $R$: Razão da Depreciação ($R = 1/I_R$)

. . . 
        
| TIPO                                                 |Vida útil | R (%) |
|------------------------------------------------------|----------|-------|
| Barracos                                             | 25       | 4,0   |
| Residência Proletário  Rústico a médio comercial     | 67       | 1,5   |
| Residências médio superior a luxo                    | 50       | 2,0   |
| Apartamentos e Escritórios                           | 40       | 40    |
| Armazéns e Indústrias                                | 67       | 67    |
| Construções de Madeira                               | 25       | 25    |

: Razões a considerar no método do valor decrescente

-   Ou pelo método da linha reta:
    -   $F_{OC}= P_R + \frac{I_R-I_E}{I_R}.P_D$
        -   $P_R$: Parcela Residual (20%)
        -   $P_D$: Parcela Depreciável (80%)
        -   $I_E$: Idade da Edificação
        -   $I_R$: Idade de Referência

## Apartamentos {.smaller}

### @damato [p. 263-264]

```{r}
# Comparacao do tratamento por fatores e tratamento por regressao linear

# Carregamento dos pacotes necessarios
library(tibble)
library(effects)
library(broom)
library(appraiseR)
library(knitr)

# Insercao manual dos dados
# Dados de Alonso, Foz do Iguacu (2019, p. 48)

df <- tribble(
  ~id, ~Area,  ~Aluguel, ~Condo, ~Padrao, ~Idade,
    1,    90,      2755,    285,  "Alto",     25,
    2,    87,      2310,    285, "Médio",     25,
    3,    90,      2215,    230,  "Alto",     30,
    4,    95,      1830,    230, "Baixo",     30,
    5,    90,      2000,    230,  "Alto",     30,
    6,   105,      1830,    290, "Médio",     25,
    7,   100,      1640,    250, "Baixo",     30,
    8, 93.69,        NA,    250, "Médio",     25,
)
kable(df)
```

## Solução por fatores {.smaller}

```{r}
df <- within(df,{
  k <- (1-.025)^Idade
  Fidade <- (1-.025)^25/k
  Fpadrao <- 1.926/ifelse(Padrao == "Alto", 2.16, 
                       ifelse(Padrao == "Médio", 1.926,
                              ifelse(Padrao == "Baixo", 1.692, NA)))
  Fcondo <- (250/93.69)/(Condo/Area)
  Farea <- 93.69/Area
  Foferta <- 0.9
  PU <- Foferta*Aluguel/Area
})
df$Ftotal <- 1 + (df$Farea-1) + (df$Fcondo-1) + (df$Fpadrao-1) + (df$Fidade-1)
df$PUhom <- df$PU*df$Ftotal
kable(df, digits = 2)
```

- Saneamento da amostra:

. . . 


```{r}
#| echo: true
#| message: true
outlier_analysis(df$PUhom, criterion = "chauvenet")
```

- PU médio homogeneizado: `r Reais(mean(df$PUhom[-6], na.rm = T))`$/m^2$

## Apartamentos {.smaller}

### Análise Exploratória

```{r}
plotdf(PU ~ Area + Padrao, data = df, labels = T)
```


## Apartamentos {.smaller}

### Análise de regressão

```{r}
# 1.2 Metodo Comparativo, tratamento por regressao linear

# Ajuste do modelo
library(kableExtra)

fit <- lm(PU ~ Area + Padrao, data = df)
s <- summary(fit)
fit |>
  tidy() |>
  kable(digits = 2)|>
  footnote(general = paste("Erro-padrão dos resíduos: ", 
                             brf(s$sigma, digits = 2), 
                             " em ", s$df[2], " graus de liberdade."),
           alphabet = c(paste("R2: ", 
                              brf(s$r.squared, digits = 2)),
                        paste("R2ajustado: ", 
                              brf(s$adj.r.squared, digits = 2)),
                        paste("RMSE: ",
                              brf(modelr::rmse(fit, data = df), digits = 2))
                        ),
           escape = F) 
```

## Apartamentos {.smaller}

### Análise de regressão

```{r}
# Analise dos residuos
# plot(fit)

# Graficos do Modelo
#
plot(predictorEffects(fit, residuals = T), id = T,
     axes=list(grid=TRUE, x=list(rotate=45)),
     partial.residuals=list(smooth=TRUE, span=1.25, lty = "dashed"))
```

## Apartamentos {.smaller}

### Previsão de Valores

```{r}
# Computo do valor do aluguel atraves do modelo

p <- predict(fit, newdata = list(Area = 93.69, Padrao = "Médio"),
             interval = "confidence", level = .80)
p 

# Obs.: Praticamente o mesmo valor obtido no tratamento por fatores.
```

## Apartamentos {.smaller}

### Alternativa (não-recomendado!)

```{r}
df <- within(df, {
  PVendaProxy <- Area*k*ifelse(Padrao == "Alto", 2.16,
                             ifelse(Padrao == "Médio", 1.926,
                                    ifelse(Padrao == "Baixo", 1.692, NA)))*1000
})
library(ggpmisc)
ggplot(df, aes(x = PVendaProxy, y = PU)) +
  geom_point() +
  stat_poly_line(formula = y ~ x - 1) +
  stat_poly_eq(use_label(c("eq", "R2")), size = 6, formula = y ~ x - 1) +
  geom_segment(x = 0, xend = 95821.93, y = 21.25, yend = 21.25, color = "red", size=1.5) +
  geom_segment(x = 95821.93, xend = 95821.93, y = 0, yend = 21.25, color = "red", size=1.5) +
  theme_grey(base_size = 20)
```

## Apartamentos {.smaller}

### Alternativa

```{r}
fit1 <- lm(PU ~ I(Area-93.7) + I(PVendaProxy-95821.93), data = df)
s1 <- summary(fit1)
fit1 |>
  tidy() |>
  kable(digits = 3) |>
  footnote(general = paste("Erro-padrão dos resíduos: ", 
                             brf(s1$sigma, digits = 2), 
                             " em ", s1$df[2], " graus de liberdade."),
           alphabet = c(paste("R2: ", 
                              brf(s1$r.squared, digits = 2)),
                        paste("R2ajustado: ", 
                              brf(s1$adj.r.squared, digits = 2)),
                        paste("RMSE: ",
                              brf(modelr::rmse(fit1, data = df), digits = 2))
                        ),
           escape = F)
```

## Apartamentos {.smaller}

### Análise de regressão

```{r}
# Analise dos residuos
# plot(fit)

# Graficos do Modelo
#
plot(predictorEffects(fit1, residuals = T), id = T,
     axes=list(grid=TRUE, x=list(rotate=45)),
     partial.residuals=list(smooth=TRUE, span=1.25, lty = "dashed"))
```
## Apartamentos (2) {.smaller .scrollable}

### @damato [p. 372]

```{r}
library(readxl)
dados <- read_excel("data/DamatoAlonso_p372.xlsx")
kable(dados, digits = 2, 
      format.args = list(big.mark = ".", decimal.mark = ","),
      col.names =c("Id", "Aluguel (R$)", "Venda (R$)", "Área Útil (m2)", "Condomínio (R$)",
                   "Local", "Padrao", "Idade", "Vida útil", "Conservação")) 
```

## Apartamentos (2) {.smaller}

```{r}
dados <- within(dados, {
  C <- 1-sapply(dados$Conservacao, heidecke)
  k <- (1-C)*(1-.5*(Idade/VidaUtil + Idade^2/VidaUtil^2))
  Foc <- .2+.8*k
  PU <- .9*Aluguel/AreaUtil
  Condo <- Condominio/AreaUtil
  Padrao <- factor(Padrao)
  PadraoProxy <- ifelse(Padrao == "Medio", 1.926, 
                        ifelse(Padrao == "Superior", 2.406,
                               ifelse(Padrao == "Fino", 3.066, NA)))
})
dados <- within(dados,{
  FArea <- 78/AreaUtil
  FCondo <- 6.37/Condo
  FLocal <- 796/Local
  FPadrao <- 2.406/PadraoProxy
  FFoc <- .753/Foc
})
dados <- within(dados, SumFatores <- 1+ FArea + FCondo + FLocal + FPadrao + FFoc - 5)
dados <- within(dados, PUhom <- SumFatores*PU)
kable(dados, digits = 2, 
      format.args = list(big.mark = ".", decimal.mark = ","))
```

## Apartamentos (2) {.smaller}

- Saneamento da amostra:

. . . 

```{r}
#| echo: true
outlier_analysis(dados$PUhom, criterion = "chauvenet")
```

- $PU_{hom} =$ `r mean(dados$PUhom[-c(8,11)], na.rm = T)`  

## Lojas {.smaller}

### @damato [p. 240]

- 37 dados de lojas de dierentes ramos

. . . 

```{r}
library(forcats)
df <- read_excel("./data/DamatoAlonso_p240.xlsx")
df$Atividade <- factor(df$Atividade)
df$Atividade <- fct_reorder(df$Atividade, df$VU)
kable(head(df, 10), digits = 2, 
      format.args = list(big.mark = ".", decimal.mark = ","))
```

## Lojas (análise exploratória)

```{r, fig.cap="Lojas de shopping por atividade. Relação VU vs. Área."}
my.formula <- y ~ x
ggplot(df, aes(x = Area, y = VU)) +
  stat_smooth(method = "lm") +
  geom_point(aes(x = Area, y = VU, color = Atividade)) +
  stat_poly_eq(formula = my.formula,
               eq.with.lhs = "italic(hat(y))~`=`~",
               label.x = "right", label.y = "top",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) +
  theme(legend.position = "bottom")
```

## Lojas (modelo)

```{r, out.width="100%", fig.width=12, fig.height=6}
fit <- lm(log(VU) ~ log(Area) + Andar + Atividade, df)
plot(predictorEffects(fit, predictors = c("Area", "Atividade"), 
                      residuals = T), 
     id = T, axes=list(x=list(rotate=45)))
```

## Lojas


```{r}
plot(predictorEffect("Andar", fit),
     axes=list(y=list(transform=exp, lab="VU")))
```

## Lojas

```{r}
s <- summary(fit)
tabela <- tidy(fit)
tabela$term <- c("Intercepto", "log(Area)", "Andar Térreo", "Importados", 
                 "Tapetes", "Informática", "Fast-Food", "Esportes", 
                 "Roupas Masc.", "Roupas Fem.", "Bancos", "Jóias"
                 )
kable(tabela, digits = 2, 
      format.args = list(big.mark = ".", decimal.mark = ","),
      col.names = c("Termo", "Estimativa", "Erro-padrão",
                    "Estatística t", "p-valor")) |>
  footnote(general = paste("Erro-padrão dos resíduos: ", 
                             brf(s$sigma, digits = 2), 
                             " em ", s$df[2], " graus de liberdade."),
           alphabet = c(paste("R2: ", 
                              brf(s$r.squared, digits = 2)),
                        paste("R2ajustado: ", 
                              brf(s$adj.r.squared, digits = 2)),
                        paste("RMSE: ",
                              brf(modelr::rmse(fit, data = df), 
                                  digits = 2))
                        ),
           escape = F)
```

## Lojas (avaliação)

* De posse do modelo acima, avaliar o valor mínimo do aluguel de uma loja de 
110m2, de roupas masculinas no piso térreo neste shopping center.

```{r}
p <- predict(fit, newdata = list(Area = 110, Atividade = "roupas masculinas",
                                Andar = "térreo"), 
             interval = "confidence", level = 0.80)
```


* O valor calculado foi de: `r brf(exp(p[, "fit"]))` [`r brf(exp(p[, "lwr"]))`; 
`r brf(exp(p[, "upr"]))`]


## Terrenos

### Considerações importantes

* Primeiro há de se considerar o melhor uso, se comercial ou residencial
   + Terrenos residenciais, em geral, não são para locar.
   + Apenas os terrenos comerciais nos interessam aqui.
* Deve-se dar preferência ao Método Comparativo
   + Problema: pode haver falta de dados para comparação
   + Com poucos dados, pode ser viável apenas o tratamento por fatores
   + Pode-se buscar dados de terrenos com construções para aumentar a amostra,
   descontando, é claro, o valor das construções para efeito de comparativo
* Na ausência de dados em número suficiente, deve-se utilizar o Método da 
Remuneração do Capital

## Terrenos {.smaller}

### @damato [p. 204]

```{r}
dadosTerrenos <- read_excel("./data/Alonso_p61.xlsx")
kable(head(dadosTerrenos[, -c(4, 11, 13)], 6), digits = 2, 
      format.args = list(big.mark = ".", decimal.mark = ","),
      col.names = c("Id", "Índice Local", "Preço", "Preço (FO)",
                    "Área", "Frente Principal", "Prof. Eq.", "Frente Sec.", 
                    "A. Construída", "Padrão", "Fd"))
```

- Não se trata de um caso de aluguel resolvido pelo Comparativo.
  - Porém era mais natural apresentar aqui neste ponto.

## Terrenos (análise exploratória)

```{r}
my.formula <- y ~ x
ggplot(dadosTerrenos, aes(x = Area, y = Valor)) +
  geom_point() + 
  stat_smooth(method = "lm") +
  labs(x = "Área do Terreno (m2)") +
  stat_poly_eq(formula = my.formula,
               eq.with.lhs = "italic(hat(y))~`=`~",
               label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) +
  scale_y_continuous(labels = scales::label_number_auto()) + 
  scale_x_continuous(labels = scales::label_number_auto()) 
```

## Terrenos (análise exploratória)

```{r}
my.formula <- y ~ x
ggplot(dadosTerrenos[-6, ], aes(x = Area, y = Valor)) +
  geom_point() + 
  stat_smooth(method = "lm") +
  labs(x = "Área do Terreno (m2)") +
  stat_poly_eq(formula = my.formula,
               eq.with.lhs = "italic(hat(y))~`=`~",
               label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) +
  scale_y_continuous(labels = scales::label_number_auto()) + 
  scale_x_continuous(labels = scales::label_number_auto()) 
```

## Terrenos 

### Cálculo do valor residual

```{r}
CB <- 1372.53
dadosTerrenos <- within(dadosTerrenos, {
  ValorConstrucao <- CB*AreaConstruida*FatorPadrao*Foc
  ValorConstrucao[is.na(ValorConstrucao)] <- 0
  ValorResidual <- Valor-ValorConstrucao
})
kable(head(dadosTerrenos[, c("Id", "Preco", "AreaConstruida", "FatorPadrao", "Foc", 
                             "ValorConstrucao", "ValorResidual")], 10), 
      digits = 2, 
      format.args = list(big.mark = ".", decimal.mark = ","),
      col.names = c("Id", "Preço", "A. Construída", "Padrão", "Fd", "Valor da Construção", "Valor Residual"))
```

## Terrenos 

```{r}
my.formula <- y ~ x
ggplot(dadosTerrenos[-6, ], aes(x = Area, y = ValorResidual)) +
  geom_point() + 
  stat_smooth(method = "lm") +
  labs(x = "Área do Terreno (m2)") +
  stat_poly_eq(formula = my.formula,
               eq.with.lhs = "italic(hat(y))~`=`~",
               label.x = "left",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) +
  scale_y_continuous(labels = scales::label_number_auto()) + 
  scale_x_continuous(labels = scales::label_number_auto()) 
```

## Terrenos 

```{r}
my.formula <- y ~ x
ggplot(dadosTerrenos[-c(6), ], aes(x = Area, y = ValorResidual)) +
  geom_point() + 
  stat_smooth(method = "lm") +
  labs(x = "Área do Terreno (m2)") +
 # xlim(c(155-0, 650))+
  stat_poly_eq(formula = my.formula,
               eq.with.lhs = "italic(hat(y))~`=`~",
               label.x = "right", label.y = "bottom",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) +
  scale_y_continuous(transform = "log", labels = scales::label_number_auto()) + 
  scale_x_continuous(transform = "log", labels = scales::label_number_auto())
```

## Terrenos 

```{r}
my.formula <- y ~ x
ggplot(dadosTerrenos[-c(1, 6), ], aes(x = Area, y = ValorResidual)) +
  geom_point() + 
  stat_smooth(method = "lm") +
  labs(x = "Área do Terreno (m2)") +
 # xlim(c(155-0, 650))+
  stat_poly_eq(formula = my.formula,
               eq.with.lhs = "italic(hat(y))~`=`~",
               label.x = "right", label.y = "bottom",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) +
  scale_y_continuous(transform = "log", labels = scales::label_number_auto()) + 
  scale_x_continuous(transform = "log", labels = scales::label_number_auto())
```

## Terrenos (modelo) {.smaller}

```{r}
fit <- lm(log(ValorResidual) ~ log(Area), dadosTerrenos, subset = -c(1, 6))
s <- summary(fit)
tabela <- tidy(fit)
kable(tabela, digits = 2, 
      format.args = list(big.mark = ".", decimal.mark = ","),
      col.names = c("Termo", "Estimativa", "Erro-padrão", 
                    "Estatística t", "p-valor")) |>
  footnote(general = paste("Erro-padrão dos resíduos: ", 
                             brf(s$sigma, digits = 2), 
                             " em ", s$df[2], " graus de liberdade."),
           alphabet = c(paste("R2: ", 
                              brf(s$r.squared, digits = 2)),
                        paste("R2ajustado: ", 
                              brf(s$adj.r.squared, digits = 2)),
                        paste("RMSE: ",
                              brf(modelr::rmse(fit, data = dadosTerrenos), 
                                  digits = 2))
                        ),
           escape = F)
```

## Terrenos (avaliação)

* Valor de venda:

. . . 


```{r}
p <- predict(fit, newdata = list(Area = 881.76), 
             interval = "confidence", level = 0.80)
exp(p)
```

* Valor de Locação: $1.060.000,00*[(1+0,06)^{1/12}-1]=$ `r brf(1060000*((1+.06)^(1/12)-1))`

## Armazéns {.smaller}

### @damato [p. 251]

```{r}
dadosArmazens <- read_excel("./data/DamatoAlonso_p251.xlsx", 
    col_types = c(rep("numeric", 6), "text", rep("numeric", 4)))
dadosArmazens <- within(dadosArmazens, VU <- Aluguel/AreaTerreno)
kable(head(dadosArmazens[, -11], 7), digits = 2, 
      format.args = list(big.mark = ".", decimal.mark = ","),
      col.names = c("Id", "A. terreno", "A. Construída", "Galpão",
                    "Escrit.", "Docas", "Padrão", "Idade", "Aluguel",
                    "VU"))
```

- Considerado: $VU = \frac{Aluguel}{AreaTerreno}$

## Armazéns (análise exploratória)

```{r, fig.cap="Lojas de shopping por atividade. Relação VU vs. Área."}
my.formula <- y ~ x
ggplot(dadosArmazens, aes(x = AreaTerreno, y = VU)) +
  stat_smooth(method = "lm") +
  geom_point(aes(x = AreaTerreno, y = VU, color = Padrao)) +
  stat_poly_eq(formula = my.formula,
               eq.with.lhs = "italic(hat(y))~`=`~",
               label.x = "right", label.y = "top",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) +
  theme(legend.position = "bottom")
```

## Armazéns (análise exploratória)

```{r, fig.cap="Lojas de shopping por atividade. Relação VU vs. Área."}
my.formula <- y ~ x
ggplot(dadosArmazens, aes(x = AreaTerreno, y = VU)) +
  stat_smooth(method = "lm") +
  geom_point(aes(x = AreaTerreno, y = VU, color = Idade)) +
  stat_poly_eq(formula = my.formula,
               eq.with.lhs = "italic(hat(y))~`=`~",
               label.x = "right", label.y = "top",
               aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
               parse = TRUE) +
  theme(legend.position = "bottom")
```

## Armazéns (modelo) {.smaller}

```{r}
fit <- lm(log(VU) ~ log(AreaTerreno/15000) + log(AreaConstruida/12086.22) + I(Idade-10), 
          data = dadosArmazens)
tabela <- tidy(fit)
kable(tabela, digits = 2, 
      format.args = list(big.mark = ".", decimal.mark = ","),
      col.names = c("Termo", "Estimativa", "Erro-padrão", "Estatística t", "p-valor"))
```

- Equação de Estimação: $$VU = 5,99.\left(\frac{AreaTerreno}{15000}\right)^{-1,03}.\left(\frac{AreaConstruida}{12.086,22}\right)^{0,83}.0,98^{Idade-10}$$

## Armazéns (modelo)

```{r}
#| fig-cap: "Gráficos de efeitos marginais."
#| fig-width: 12
#| fig-height: 6
plot(predictorEffects(fit, predictors = c("AreaTerreno", "AreaConstruida"), 
                      residuals = T), 
     id = T, axes=list(x=list(rotate=45)))
```

## Armazéns (modelo)

```{r, fig.cap="Gráfico marginal da variável Idade."}
plot(predictorEffect("Idade", fit, residuals = T), 
     id = T, axes=list(x=list(rotate=45)))
```

## Armazéns (Poder de Predição)

```{r}
powerPlot(fit, system = "ggplot2", axis = "inverted")
```

## Armazéns (Poder de Predição)

```{r}
fit1 <- update(fit, subset = -4)
powerPlot(fit1, system = "ggplot2", Smooth = TRUE, axis = "inverted")
```


## Armazéns (Avaliação)

* De posse do modelo acima, avaliar o valor do aluguel de um armazém com terreno
de área igual a 15.000 m2, com Área Construída de 12.086,22 e Idade igual a 
5 anos.

. . . 

```{r echo = T}
p <- predict(fit1, newdata = list(AreaTerreno = 15000, AreaConstruida = 12086.22,
                                 Idade = 5),
             interval = "confidence", level = 0.80)
exp(p)
```


- O valor calculado foi de: `r brf(15000*0.9*exp(p[, "fit"]))` 
[`r brf(15000*0.9*exp(p[, "lwr"]))`; `r brf(15000*0.9*exp(p[, "upr"]))`]

- @damato [p. 254]: R$ 90.936,00
  - Modelo: $\frac{1}{Area} = 2,5765.10^{-5}+\frac{0,09618}{\text{Area Construida}}-3,7878.10^{-6}.\text{Conservacao}$

# Casos Especiais

## Cinemas

- Em casos especiais, como nos cinemas, pode ser utilizado o *Método da Participação*
  - Tal método consiste em:
    - Aferir a renda líquida do estabelecimento
    - Aplicar a esta renda líquida um percentual médio de mercado para calcular
    o aluguel justo ao locador
    
- Segundo @damato [p. 296]:

. . . 

> Obtida a média final (das rendas líquidas), seria a mesma capitalizada em base
às taxas de renda usuais para cinemas que são: 10% quando os equipamentos e 
instalações são de propriedade do inquilino e 15% quando pertencem ao 
proprietário do imóvel.

## Cinemas {.smaller}

### Exemplo [@damato, p. 297]

```{r}
dadosCinema <- read_excel("data/DamatoAlonso_p296.xlsx")
kable(head(dadosCinema), digits = 2,
      format.args = list(big.mark = ".", decimal.mark =","))
```


```{r}
library(lubridate)
dadosCinema$Ano <- year(dadosCinema$Mês)
```

- @damato [p. 297]: $Al = 185.358,54\times12\% =\text{R\$ }22.240,00$

## Problema

```{r}
#| echo: true
tapply(dadosCinema$`Renda Líquida Descontada`, dadosCinema$Ano, mean)
```

- O resultado tem aumentado anualmente em torno de 10% a.a.
- Ao considerar a média dos rendimentos anuais, @damato obtiveram um aluguel
condizente com o ano de 2016!
- Isto não me parece correto!

## Problemas com o Método da Participação {.smaller}

> Foram apresentados métodos de participação para "postos de gasolina" e para
"cinemas". O método para "postos de serviços" foi desenvolvido pelo engenheiro
José Carlos Pellegrino e para os "cinemas", pelo engenheiro Nelson Roberto
Pereira Alonso. Nesses processos de participação, o aluguel é vinculado ao 
resultado comercial do estabelecimento empresarial do inquilino.
Se, por um lado, possui a vantagem de permitir o estabelecimento do aluguel para
imóveis com destinação específica, tem, na opinião do autor, as desvantagens de
punir o bom e permiar o mau comerciante, e ainda de impedir que o proprietário
usufrua da renda de seu patrimônio de uma forma mais lucrativa do que aquela para 
o qual originalmente foi destinado.

> Se, por qualquer motivo, a destinação original que foi dada ao imóvel passar 
a ser inviável, não é dado ao proprietário do prédio o direito de se afastar
desse "prejuízo"...

## Referências
